@åŠŸèƒ½å®ç°.mdç°åœ¨å·²ç»å®Œæˆäº†æ ¸å¿ƒ1.
å‡†å¤‡å¼€å§‹åšæ ¸å¿ƒ4ï¼Œ
è¦å®ŒæˆGameObjectå’ŒComponentï¼ˆTransformï¼Œ meshã€ Rendererã€ï¼‰ ä»¥åŠè„šæœ¬çš„Update Awake startè¿™äº›ï¼Œ
ä»¥åŠåœºæ™¯ã€é¢„åˆ¶ä½“ã€çš„åºåˆ—åŒ–åŠ è½½ã€‚
AABBå’Œå‰”é™¤ã€‚ ç»™ä¸€äº›å¤§è‡´çš„æ€è€ƒé€»è¾‘ï¼Œæˆ–è€…å’Œæˆ‘ç®€å•èŠä¸€èŠï¼Œ ä¸‹é¢çš„ä¸€ä¸ªæ—¥ç¨‹å®‰æ’

éå¸¸å¥½çš„é—®é¢˜ï¼è¿™ä¸‰ä¸ªè®¾è®¡å†³ç­–ä¼šç›´æ¥å½±å“æ•´ä¸ªå¼•æ“çš„æ¶æ„ã€‚è®©æˆ‘é€ä¸€åˆ†æï¼š

[3 tools called]

å¥½çš„ï¼Œçœ‹äº†ä»£ç åæˆ‘ç»™ä½ è¿™ä¸‰ä¸ªå…³é”®é—®é¢˜çš„è®¾è®¡å»ºè®®ï¼š

## ğŸ¥ é—®é¢˜1ï¼šç›¸æœºç³»ç»Ÿè®¾è®¡

### å½“å‰çŠ¶æ€åˆ†æ
ä½ çš„`Camera`ç°åœ¨åªè´Ÿè´£ç®¡ç†RenderPasså’ŒFrameBufferï¼Œ**ç¼ºå°‘æ ¸å¿ƒçš„ç›¸æœºæ•°å­¦é€»è¾‘**ï¼š
- âŒ æ²¡æœ‰ViewçŸ©é˜µï¼ˆç›¸æœºä½ç½®å’Œæœå‘ï¼‰
- âŒ æ²¡æœ‰ProjectionçŸ©é˜µï¼ˆé€è§†/æ­£äº¤æŠ•å½±ï¼‰
- âŒ æ²¡æœ‰ViewProjectionçŸ©é˜µï¼ˆç”¨äºMVPå˜æ¢ï¼‰
- âŒ æ²¡æœ‰Frustumæå–ï¼ˆç”¨äºå‰”é™¤ï¼‰

### è®¾è®¡å»ºè®®

**æ–¹æ¡ˆAï¼šCameraä½œä¸ºç‹¬ç«‹ç±»ï¼ˆæ¨èçŸ­æœŸæ–¹æ¡ˆï¼‰**
```cpp
// å…ˆä¿æŒCameraä½œä¸ºç‹¬ç«‹ç±»ï¼Œä¸ä½œä¸ºComponent
class Camera {
    // æ•°å­¦æ•°æ®
    Vector3 position;
    Vector3 forward, up, right;
    Matrix4x4 viewMatrix;
    Matrix4x4 projectionMatrix;
    Matrix4x4 viewProjectionMatrix;
    
    // é€è§†ç›¸æœºå‚æ•°
    float fov = 60.0f;
    float aspectRatio = 16.0f/9.0f;
    float nearClip = 0.1f;
    float farClip = 1000.0f;
    
    // æ–¹æ³•
    void SetPerspective(float fov, float aspect, float near, float far);
    void LookAt(Vector3 eye, Vector3 target, Vector3 up);
    void UpdateMatrices(); // æ›´æ–°Viewå’ŒProjection
    Frustum GetFrustum(); // æå–è§†é”¥ç”¨äºå‰”é™¤
    
    // ç°æœ‰çš„æ¸²æŸ“ç®¡çº¿æ•°æ®
    RenderPassAsset mRenderPassAsset;
    ResourceHandle<FrameBufferObject> colorAttachment;
    ResourceHandle<FrameBufferObject> depthAttachment;
};
```

**æ–¹æ¡ˆBï¼šCameraä½œä¸ºComponentï¼ˆæ¨èé•¿æœŸæ–¹æ¡ˆï¼‰**
```cpp
// åˆ†ç¦»æ•°å­¦é€»è¾‘å’Œæ¸²æŸ“ç®¡çº¿é€»è¾‘
class CameraComponent : public Component {
    float fov = 60.0f;
    float nearClip = 0.1f;
    float farClip = 1000.0f;
    
    Matrix4x4 GetViewMatrix(); // ä»Transformè·å–
    Matrix4x4 GetProjectionMatrix();
    Frustum GetFrustum();
    
    // æ¸²æŸ“ç®¡çº¿é…ç½®
    RenderPassAsset renderPassAsset;
    ResourceHandle<FrameBufferObject> colorAttachment;
    ResourceHandle<FrameBufferObject> depthAttachment;
};

// GameObjectä¸Šéœ€è¦æœ‰Transformæ‰èƒ½è®¡ç®—ViewçŸ©é˜µ
```

### æˆ‘çš„å»ºè®®è·¯çº¿å›¾

**Week 1ï¼šå¿«é€Ÿé›†æˆæ–¹æ¡ˆ**
```
1. æ‰©å±•ç°æœ‰Cameraç±»ï¼Œæ·»åŠ æ•°å­¦é€»è¾‘ï¼ˆæ–¹æ¡ˆAï¼‰
2. æ·»åŠ Matrix4x4çš„è¿ç®—æ–¹æ³•ï¼ˆä¹˜æ³•ã€é€†çŸ©é˜µã€LookAtã€Perspectiveï¼‰
3. Camera.SetPerspective() å’Œ Camera.LookAt()
4. æ¸²æŸ“æ—¶ä¼ é€’VPçŸ©é˜µç»™Shader
```

**Week 2-3ï¼šç»„ä»¶åŒ–æ”¹é€ **
```
5. ç­‰Transformç³»ç»Ÿå®Œæˆåï¼Œå°†Cameraæ”¹é€ ä¸ºCameraComponent
6. Cameraé€šè¿‡GetComponent<Transform>()è·å–ä½ç½®
7. SceneManagerç®¡ç†ä¸»ç›¸æœºåˆ‡æ¢
```

### ç«‹å³éœ€è¦è¡¥å……çš„æ•°å­¦åŠŸèƒ½

**Matrix4x4æ‰©å±•**ï¼š
```cpp
class Matrix4x4 {
    // ç°æœ‰çš„æ„é€ å‡½æ•°...
    
    // éœ€è¦æ·»åŠ çš„æ–¹æ³•ï¼š
    static Matrix4x4 Perspective(float fov, float aspect, float near, float far);
    static Matrix4x4 LookAt(Vector3 eye, Vector3 target, Vector3 up);
    Matrix4x4 operator*(const Matrix4x4& other) const;
    Matrix4x4 Inverse() const;
    Vector3 MultiplyPoint(const Vector3& point) const; // ç”¨äºå˜æ¢
    
    // éœ€è¦è®¿é—®å™¨
    float* GetData() { return &m00; } // ä¼ ç»™Shader
};
```

**Frustumç»“æ„**ï¼š
```cpp
struct Plane {
    Vector3 normal;
    float distance;
};

struct Frustum {
    Plane planes[6]; // Left, Right, Top, Bottom, Near, Far
    
    void ExtractFromMatrix(const Matrix4x4& vp);
    bool Intersects(const AABB& aabb) const; // ç”¨äºå‰”é™¤
};
```

---

## ğŸ§© é—®é¢˜2ï¼šComponentè™šå‡½æ•°æ¥å£è®¾è®¡

### ä½ çš„æ€è€ƒæ˜¯**å®Œå…¨æ­£ç¡®**çš„ï¼

**æ ¸å¿ƒè§‚ç‚¹**ï¼šä¸æ˜¯æ‰€æœ‰Componentéƒ½éœ€è¦ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼Œåªæœ‰**è„šæœ¬ç±»ç»„ä»¶**éœ€è¦ã€‚

### æ¨èçš„åˆ†å±‚è®¾è®¡

```cpp
// åŸºç¡€Componentï¼šçº¯æ•°æ®ï¼Œæ— è¡Œä¸º
class Component {
public:
    GameObject* gameObject;
    bool enabled = true;
    
    virtual ~Component() = default;
    // ä¸éœ€è¦ Awake/Update ç­‰è™šå‡½æ•°
};

// æ¸²æŸ“ç»„ä»¶ï¼šçº¯æ•°æ®
class MeshFilter : public Component {
    ResourceHandle<Mesh> mesh;
};

class MeshRenderer : public Component {
    ResourceHandle<Material> material;
    AABB bounds;
};

class Transform : public Component {
    Vector3 position, scale;
    Quaternion rotation;
    // æœ‰æ–¹æ³•ä½†ä¸æ˜¯ç”Ÿå‘½å‘¨æœŸå›è°ƒ
    Matrix4x4 GetLocalToWorldMatrix();
};

// ===========================================
// è„šæœ¬ç»„ä»¶ï¼šæœ‰ç”Ÿå‘½å‘¨æœŸçš„è¡Œä¸ºç»„ä»¶
class MonoBehaviour : public Component {
public:
    // ç”Ÿå‘½å‘¨æœŸè™šå‡½æ•°
    virtual void Awake() {}
    virtual void Start() {}
    virtual void Update(float deltaTime) {}
    virtual void OnDestroy() {}
    
protected:
    bool hasStarted = false;
};

// ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ç»§æ‰¿è‡ªMonoBehaviour
class PlayerController : public MonoBehaviour {
    void Start() override {
        // åˆå§‹åŒ–é€»è¾‘
    }
    
    void Update(float deltaTime) override {
        // æ¯å¸§é€»è¾‘
    }
};
```

### ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ

**æ€§èƒ½è€ƒè™‘**ï¼š
- MeshFilterã€Transformè¿™äº›ç»„ä»¶æ•°é‡å¾ˆå¤šï¼ˆæˆç™¾ä¸Šåƒä¸ªï¼‰
- å¦‚æœéƒ½æœ‰è™šå‡½æ•°ï¼Œæ¯å¸§Updateéå†å¼€é”€å¤§
- å®é™…ä¸Šåªæœ‰å°‘æ•°è„šæœ¬ç»„ä»¶éœ€è¦Update

**è®¾è®¡æ¸…æ™°**ï¼š
- Component = æ•°æ®å®¹å™¨
- MonoBehaviour = è¡Œä¸ºè„šæœ¬
- ç¬¦åˆUnity/Unrealçš„æˆç†Ÿæ¨¡å¼

### ç”Ÿå‘½å‘¨æœŸè°ƒåº¦

```cpp
class SceneManager {
    std::vector<GameObject*> gameObjects;
    std::vector<MonoBehaviour*> scripts; // å•ç‹¬ç®¡ç†è„šæœ¬
    
    void Update(float deltaTime) {
        // åªéå†è„šæœ¬ç»„ä»¶ï¼Œä¸éå†æ‰€æœ‰Component
        for (auto* script : scripts) {
            if (!script->hasStarted) {
                script->Start();
                script->hasStarted = true;
            }
            if (script->enabled) {
                script->Update(deltaTime);
            }
        }
    }
    
    void RegisterScript(MonoBehaviour* script) {
        scripts.push_back(script);
    }
};
```

---

## ğŸ—ï¸ é—®é¢˜3ï¼šECS vs ä¼ ç»ŸGameObjectæ¨¡å¼

### çŸ­æœŸå»ºè®®ï¼š**å…ˆåšä¼ ç»Ÿæ¨¡å¼**

**åŸå› **ï¼š
1. **ä½ çš„å¼•æ“è§„æ¨¡å°**ï¼šä¸æ˜¯DOTS/Flecsé‚£ç§ç™¾ä¸‡å®ä½“åœºæ™¯
2. **å¼€å‘æ•ˆç‡**ï¼šä¼ ç»Ÿæ¨¡å¼æ›´ç›´è§‚ï¼Œè°ƒè¯•å®¹æ˜“
3. **èµ„æ–™ä¸°å¯Œ**ï¼šUnity/Unrealéƒ½ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œå‚è€ƒå¤š
4. **ECSå­¦ä¹ æˆæœ¬é«˜**ï¼šComponentä¸èƒ½æœ‰æŒ‡é’ˆã€éœ€è¦Archetypeç®¡ç†ç­‰

### ä½†è¦**ä¿æŒæ¶æ„çµæ´»æ€§**

#### è®¾è®¡åŸåˆ™ï¼ˆæ–¹ä¾¿åç»­é‡æ„ï¼‰

**1. æ•°æ®ä¸è¡Œä¸ºåˆ†ç¦»**
```cpp
// âœ… Goodï¼šçº¯æ•°æ®Component
class Transform : public Component {
    Vector3 position;
    Quaternion rotation;
    Vector3 scale;
    // ç®€å•çš„getter/setterå¯ä»¥æœ‰
};

// âŒ Badï¼šComponentæŒæœ‰å¤æ‚å¯¹è±¡
class MeshRenderer : public Component {
    std::vector<Material*> materials; // å¦‚æœæ”¹ECSä¼šå¾ˆéº»çƒ¦
};

// âœ… Betterï¼šç”¨Handle/ID
class MeshRenderer : public Component {
    ResourceHandle<Material> material; // ResourceHandleæ˜¯POD
};
```

**2. é¿å…Componentä¹‹é—´ç›´æ¥å¼•ç”¨**
```cpp
// âŒ Bad
class PlayerController : public MonoBehaviour {
    MeshRenderer* renderer; // ç›´æ¥æŒæœ‰æŒ‡é’ˆ
};

// âœ… Good
class PlayerController : public MonoBehaviour {
    void Update() {
        auto* renderer = gameObject->GetComponent<MeshRenderer>();
    }
};
```

**3. SystemåŒ–çš„æ€æƒ³**
```cpp
// å³ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ç”¨Systemæ€ç»´

// TransformSystemï¼šç»Ÿä¸€æ›´æ–°æ‰€æœ‰Transform
class TransformSystem {
    static void UpdateHierarchy(Scene* scene) {
        for (auto* go : scene->GetRootObjects()) {
            UpdateRecursive(go->GetComponent<Transform>());
        }
    }
};

// RenderSystemï¼šæ”¶é›†æ‰€æœ‰Renderer
class RenderSystem {
    static void CollectRenderables(Scene* scene, RenderContext& ctx) {
        for (auto* go : scene->GetAllObjects()) {
            if (auto* renderer = go->GetComponent<MeshRenderer>()) {
                if (auto* filter = go->GetComponent<MeshFilter>()) {
                    // æ”¶é›†æ¸²æŸ“æ•°æ®
                }
            }
        }
    }
};
```

### å¦‚æœä»¥åè¦æ”¹ECS

**ä¿æŒè¿™äº›è®¾è®¡å°±å®¹æ˜“è¿ç§»**ï¼š
- Componentæ˜¯PODæ•°æ®ï¼ˆPlain Old Dataï¼‰
- ç”¨Handle/IDè€Œä¸æ˜¯æŒ‡é’ˆ
- é€»è¾‘é›†ä¸­åœ¨Systemè€Œä¸æ˜¯æ•£è½åœ¨Componenté‡Œ
- æ•°æ®ç´§å‡‘æ’åˆ—ï¼ˆè€ƒè™‘ç”¨æ± åŒ–åˆ†é…å™¨ï¼‰

### ç°é˜¶æ®µçš„GetComponentå®ç°å»ºè®®

```cpp
// ä½ ç°åœ¨çš„multimapå®ç°æ˜¯OKçš„ï¼Œä½†å¯ä»¥ä¼˜åŒ–

class GameObject {
    // ç°æœ‰æ–¹æ¡ˆï¼šmultimap
    std::multimap<ComponentType, Component*> components;
    
    // ä¼˜åŒ–æ–¹æ¡ˆ1ï¼šunordered_mapï¼ˆå¤§å¤šæ•°ç»„ä»¶å”¯ä¸€ï¼‰
    std::unordered_map<ComponentType, Component*> components;
    
    // ä¼˜åŒ–æ–¹æ¡ˆ2ï¼šæ•°ç»„ï¼ˆComponentç±»å‹å°‘æ—¶æœ€å¿«ï¼‰
    Component* componentArray[MAX_COMPONENT_TYPES];
    
    // æ¨èï¼šå…ˆç”¨unordered_mapï¼Œç®€å•é«˜æ•ˆ
    template<typename T>
    T* GetComponent() {
        auto it = components.find(T::GetType());
        return it != components.end() ? static_cast<T*>(it->second) : nullptr;
    }
};
```

---

## ğŸ“‹ ç»¼åˆå»ºè®®ï¼šä¿®è®¢åçš„Week 1è®¡åˆ’

### **Day 1-2ï¼šCameraæ•°å­¦é€»è¾‘ + TransformåŸºç¡€**

**ä¼˜å…ˆçº§è°ƒæ•´**ï¼šå…ˆåšCameraï¼Œå› ä¸ºæ¸²æŸ“ä¾èµ–å®ƒ

```
Day 1ï¼šCameraç›¸æœºé€»è¾‘
- [x] æ‰©å±•Matrix4x4ï¼ˆPerspectiveã€LookAtã€ä¹˜æ³•ã€å–æ•°æ®æ¥å£ï¼‰
- [ ] å®ç°QuaternionåŸºç¡€ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
- [x] Cameraæ·»åŠ æ•°å­¦å±æ€§ï¼ˆfovã€aspectã€nearã€farï¼‰
- [x] Camera.UpdateMatrices()ç”ŸæˆView/ProjectionçŸ©é˜µ
- [x] æµ‹è¯•ï¼šèƒ½çœ‹åˆ°æ­£ç¡®çš„é€è§†æŠ•å½±æ¸²æŸ“

Day 2ï¼šTransformç»„ä»¶
- [x] å®ç°Transformç»„ä»¶ï¼ˆposition, rotation, scaleï¼‰
- [x] ç®€å•çš„çˆ¶å­å…³ç³»ï¼ˆå…ˆä¸åšå±‚çº§ï¼ŒåªåšåŸºç¡€ï¼‰
- [x] LocalToWorldçŸ©é˜µè®¡ç®—
- [x] æµ‹è¯•ï¼šç§»åŠ¨Transformèƒ½çœ‹åˆ°ç‰©ä½“ç§»åŠ¨
```

### **Day 3-4ï¼šComponentåˆ†å±‚ + MonoBehaviour**

```
Day 3ï¼šComponentæ¶æ„
- [x] ç¡®å®šComponentåŸºç±»ï¼ˆçº¯æ•°æ®ï¼Œæ— è™šå‡½æ•°ï¼‰
- [x] è®¾è®¡MonoBehaviourç±»ï¼ˆæœ‰ç”Ÿå‘½å‘¨æœŸè™šå‡½æ•°ï¼‰
- [ ] æ”¹é€ ComponentTypeæšä¸¾ï¼ˆåŒºåˆ†æ•°æ®ç»„ä»¶å’Œè„šæœ¬ç»„ä»¶ï¼‰
- [ ] GameObjectæ”¯æŒä¸¤ç±»ç»„ä»¶

Day 4ï¼šç”Ÿå‘½å‘¨æœŸç³»ç»Ÿ
- [ ] SceneManager.Update()é©±åŠ¨MonoBehaviour
- [ ] å®ç°Awake/Start/Updateè°ƒåº¦
- [ ] å†™ä¸€ä¸ªæµ‹è¯•è„šæœ¬ï¼ˆæ¯”å¦‚RotateScriptæ—‹è½¬ç‰©ä½“ï¼‰
- [ ] æµ‹è¯•ç”Ÿå‘½å‘¨æœŸé¡ºåºæ­£ç¡®
```

### **Day 5-7ï¼šæ¸²æŸ“ç»„ä»¶ + è§†é”¥å‰”é™¤åŸºç¡€**

```
Day 5-6ï¼šMeshRendererå’ŒMeshFilter
- [x] åˆ†ç¦»MeshFilterï¼ˆæŒæœ‰Meshï¼‰å’ŒMeshRendererï¼ˆæŒæœ‰Materialï¼‰
- [ ] MeshRendereræŒæœ‰AABBï¼ˆä»Meshè·å–ï¼‰
- [ ] Transformå˜åŒ–æ—¶æ›´æ–°AABB
- [ ] å¯è§†åŒ–AABBï¼ˆdebugç»˜åˆ¶ï¼‰

Day 7ï¼šFrustumå‰”é™¤é›å½¢
- [ ] å®ç°Frustumç»“æ„å’Œå¹³é¢æå–
- [ ] Camera.GetFrustum()
- [ ] ç®€å•çš„AABB-Frustumæµ‹è¯•
- [ ] Culling.Run()è°ƒç”¨å‰”é™¤é€»è¾‘
```

---

## ğŸ¯ æ€»ç»“ï¼šä¸‰ä¸ªé—®é¢˜çš„ç­”æ¡ˆ

| é—®é¢˜ | æ¨èæ–¹æ¡ˆ | ç†ç”± |
|------|---------|------|
| **ç›¸æœºç³»ç»Ÿ** | Week1å…ˆæ‰©å±•Cameraç±»æ·»åŠ æ•°å­¦é€»è¾‘<br>Week2-3æ”¹é€ ä¸ºCameraComponent | æ¸²æŸ“æ€¥éœ€VPçŸ©é˜µï¼Œå…ˆå¿«é€Ÿå®ç°<br>ç­‰Transformå®Œæˆåå†ç»„ä»¶åŒ– |
| **Componentè™šå‡½æ•°** | Componentä¸è¦è™šå‡½æ•°<br>åˆ›å»ºMonoBehaviourå­ç±» | æ€§èƒ½+æ¸…æ™°åº¦<br>éµå¾ªUnityæˆç†Ÿæ¨¡å¼ |
| **ECS vs ä¼ ç»Ÿ** | ç”¨ä¼ ç»ŸGetComponent<br>ä¿æŒæ•°æ®PODåŒ– | å¼€å‘å¿«ã€è°ƒè¯•æ˜“<br>è®¾è®¡åˆç†å¯å¹³æ»‘è¿ç§» |

æœ€å…³é”®çš„æ˜¯ï¼š**ä¿æŒç»„ä»¶æ•°æ®ç®€å•ï¼ˆPODï¼‰ï¼Œé€»è¾‘ç”¨Systemé›†ä¸­å¤„ç†ï¼Œè¿™æ ·æ¶æ„çµæ´»æ€§æœ€é«˜**ã€‚

è¿™æ ·è°ƒæ•´åä½ è§‰å¾—å¦‚ä½•ï¼Ÿéœ€è¦æˆ‘è¯¦ç»†å±•å¼€æŸä¸ªéƒ¨åˆ†çš„å®ç°ç»†èŠ‚å—ï¼Ÿ