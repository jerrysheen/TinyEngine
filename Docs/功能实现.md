# TinyEngine 功能规划与路线图

## 目前已经有的功能

### 资源加载系统
- ✅ Shader 加载
- ✅ Texture 加载
- ✅ RenderTarget 加载
- ✅ Mesh 加载

### 渲染系统
- ✅ 渲染管线：RenderAsset + RenderPass
- ✅ 多线程渲染
- ✅ D3D12 后端基础实现

### 编辑器系统
- ✅ EditorGUI 基本流程（ImGui 集成）

---

## 后续开发优先级

### P0 - 核心功能（必做）

#### 1. 统一资源加载接口
**目标**：建立通用的资源管理系统
- [ ] 设计 `AssetID/ResourceHandle` 抽象层
- [ ] 引用计数与自动生命周期管理
- [ ] 异步资源加载（IO 线程 → 解码 → GPU 上传）
- [ ] 虚拟路径与资源 Meta 文件系统
- [ ] 热重载机制（文件监视 + 自动更新）
- [ ] 资源依赖追踪与级联加载

#### 2. 帧图化渲染管线
**目标**：声明式渲染管线与资源自动管理
- [ ] FrameGraph 架构设计
- [ ] Pass 依赖声明（读/写资源）
- [ ] Transient 资源自动复用与别名
- [ ] 自动 Resource Barrier 插入
- [ ] N-frames-in-flight 管理（多帧并行）
- [ ] 可视化调试（显示 Pass 依赖图、资源生命周期）

#### 3. 基本渲染表现
**目标**：达到工业级渲染质量基线
- [ ] 光照系统（方向光/点光/聚光灯）
- [ ] 阴影系统（优先级：CSM 级联阴影）
- [ ] HDR 渲染管线 + Tonemap
- [ ] Gamma 正确处理（sRGB/Linear）
- [ ] 天空盒渲染
- [ ] IBL（基于图像的照明）基础

#### 4. 场景管理系统
**目标**：完整的场景对象与组件生命周期
- [ ] GameObject 层级变换系统（父子关系、脏标记）
- [ ] 组件生命周期管理（Awake/Start/Update/Destroy）
- [ ] 场景序列化/反序列化（推荐 JSON/YAML）
- [ ] Prefab 系统与实例化
- [ ] 场景对象选择与射线拾取
- [ ] AABB 包围盒与视锥剔除

#### 5. Editor 并入多线程
**目标**：编辑器与渲染线程安全交互
- [ ] 渲染数据双缓冲（避免竞态条件）
- [ ] 命令队列隔离（UI 线程 → 渲染线程）
- [ ] 线程安全的资源提交机制
- [ ] Editor 操作的撤销/重做栈
- [ ] 实时预览与场景编辑同步

---

### P1 - 进阶功能（建议）

#### 6. 延迟渲染完善
- [ ] G-Buffer 布局设计（法线、金属度、粗糙度、AO、自发光）
- [ ] PBR 材质系统（Cook-Torrance BRDF）
- [ ] 灯光聚类（Tiled/Clustered Lighting）
- [ ] 基本后处理（Bloom、SSAO、TAA）

#### 7. Shader 系统增强
- [ ] 编译宏与变体管理
- [ ] Shader 反射（自动生成 RootSignature/输入布局）
- [ ] 编译产物缓存（基于源码+宏 Hash）
- [ ] Shader 热重载与材质联动更新
- [ ] `#include` 依赖追踪

#### 8. 资源与内存优化
- [ ] DescriptorHeap 环形/分段管理策略
- [ ] PSO/RootSignature 缓存与复用
- [ ] Upload/Readback 队列与内存池
- [ ] 帧临时分配器（Frame Allocator）
- [ ] GPU 内存预算与监控

---

### P2 - 加值功能

#### 9. 可视化与性能剖析
- [ ] GPU/CPU Profiler 集成
- [ ] PIX/RenderDoc 标记与事件
- [ ] Pipeline 统计 Overlay（DrawCall/Triangle/Batch）
- [ ] 资源面板（显示已加载资源、内存占用）

#### 10. 几何与动画
- [ ] GPU Instancing（实例化渲染）
- [ ] 多子网格合批
- [ ] 骨骼动画/蒙皮
- [ ] Mesh 优化（meshoptimizer 集成）
- [ ] 法线/切线重建

#### 11. 跨 API 抽象
- [ ] 强化 RenderAPI 为 RHI 层
- [ ] Vulkan 后端支持
- [ ] OpenGL 后端支持（可选）
- [ ] 统一 Shader 编译工具链（SPIRV-Cross）

---

## 已有模块增强建议

### Shader 加载增强
- DXC/FXC 编译缓存（按源码+宏 Hash 落盘）
- `#include` 与宏变体管理
- 反射输出输入布局/资源绑定
- 热重载联动材质/PSO 更新

### Texture 加载增强
- sRGB/Linear 颜色空间明确化
- Mipmap 生成（离线/在线）
- KTX/DDS/BC 压缩格式支持
- CubeMap/IBL 支持
- 按需流式加载（LOD）

### RenderTarget/FrameBuffer 增强
- HDR/Depth 格式库
- MSAA 配置支持
- Transient 资源池
- 自动 Barrier 管理
- 分辨率动态变化重建

### Mesh/Model 增强
- 法线/切线自动重建
- Mesh 合批与实例化
- meshoptimizer 集成
- 大模型分块与渐进式加载
- Assimp 导入清洗与材质映射

### RenderAsset + RenderPass 增强
- Pass 描述式 DSL
- 显式读写依赖声明
- 资源别名/复用统计
- 可视化调试（显示每帧 RT/Buffer 拥有关系）

### 多线程渲染增强
- 命令列表池化（Direct/Bundle CommandList）
- Pass 级并行录制
- 轻量任务系统（Job/Fiber）
- 避免主线程阻塞

### EditorGUI 增强
- Docking 布局系统
- Gizmo（平移/旋转/缩放）
- Profiler 面板
- 材质编辑器
- 与渲染数据双缓冲

### 场景管理增强
- 层级变换与脏标记优化
- 序列化（JSON/YAML/自研二进制）
- Prefab/实例化系统
- 选择/拾取（AABB/射线）
- 场景对象池化

### D3D12 层增强
- `D3D12DescManager` 统一全局堆与回收策略
- `D3D12RenderAPI` 内建 PSO/RootSignature 缓存
- Fence/Timeline 管理
- N 帧并行优化

### 调试与健壮性
- D3D12 Debug Layer/GPU 崩溃分析器
- 参数校验与错误码系统
- 断言/日志等级
- 资源泄漏/越界检测

### 示例与验证
- 最小示例场景（天空盒 + PBR 球 + 阴影）
- Sponza/San Miguel 场景对照
- 像素对比基准测试

---

## 开发建议

### 迭代策略
1. **先横向完善 P0**：确保核心系统稳定可用
2. **再纵向深入 P1**：提升渲染质量与性能
3. **最后扩展 P2**：增加工具链与跨平台能力

### 质量保证
- 每个功能模块完成后编写单元测试
- 建立基准场景（Benchmark Scene）
- 定期 Profile 性能瓶颈
- 保持代码审查与文档同步更新

### 参考资源
- [RenderDoc](https://renderdoc.org/) - 图形调试
- [PIX](https://devblogs.microsoft.com/pix/) - D3D12 性能分析
- [meshoptimizer](https://github.com/zeux/meshoptimizer) - Mesh 优化
- [Filament](https://github.com/google/filament) - PBR 渲染参考
- [FrameGraph](https://www.gdcvault.com/play/1024612/FrameGraph-Extensible-Rendering-Architecture-in) - GDC 演讲